#!/bin/bash

ZONE_ID="Z00951673I2OYCZYMUOPO"


for NAME in $@; 
do
  INSTANCE_IDS=$(aws ec2 describe-instances \
    --filters \
      "Name=tag:Name,Values=$NAME" \
      "Name=instance-state-name,Values=running" \
    --query "Reservations[].Instances[].InstanceId" \
    --output text)

  if [ -n "$INSTANCE_IDS" ]; then # Here -n means if Instances empty true otherwise false
    echo "Terminating instances for $NAME"
    aws ec2 terminate-instances --instance-ids $INSTANCE_IDS
  else
    echo "No instance found for $NAME"
  fi
done



aws route53 change-resource-record-sets \
    --hosted-zone-id $ZONE_ID \
    --change-batch "$(aws route53 list-resource-record-sets \
        --hosted-zone-id $ZONE_ID \
        --query "ResourceRecordSets[?Type!='NS' && Type!='SOA']" \
        --output json | jq '{Changes: map({Action: "DELETE", ResourceRecordSet: .})}')"

echo "Deleted all R53 Records other than NS and SOA Types"
